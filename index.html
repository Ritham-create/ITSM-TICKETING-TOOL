<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITSM Tool - Login</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Serif+Pro&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Serif Pro', serif;
            background-color: #f5f1e8;
            background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            min-height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #3a3226;
        }

        .auth-container {
            background: rgba(245, 241, 232, 0.9);
            border: 1px solid #d4c9b8;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1), 
                        inset 0 0 15px rgba(255, 255, 255, 0.5);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            animation: slideIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #8b6b4a, #c2a582, #8b6b4a);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            font-family: 'Playfair Display', serif;
        }

        .logo h1 {
            color: #5d4b36;
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: 1px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .logo p {
            color: #7a6b58;
            font-size: 1.1em;
            font-style: italic;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #5d4b36;
            font-weight: 600;
            font-family: 'Playfair Display', serif;
        }

        input[type="text"], input[type="email"], input[type="password"], select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d4c9b8;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.7);
            font-family: inherit;
            color: #3a3226;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8b6b4a;
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 107, 74, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to bottom, #8b6b4a, #6d563d);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            font-family: 'Playfair Display', serif;
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 107, 74, 0.3);
            background: linear-gradient(to bottom, #9a7b58, #7d6347);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #7a6b58;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-right: 10px;
            font-family: 'Playfair Display', serif;
        }

        .btn-secondary:hover {
            background: #6d5f4e;
        }

        .switch-form {
            text-align: center;
            margin-top: 20px;
            color: #7a6b58;
            font-style: italic;
        }

        .switch-form a {
            color: #8b6b4a;
            text-decoration: none;
            font-weight: 600;
            font-family: 'Playfair Display', serif;
        }

        .switch-form a:hover {
            text-decoration: underline;
        }

        .error {
            color: #8b2e2e;
            background: #f8e8e8;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #e8c8c8;
            font-family: 'Source Serif Pro', serif;
        }

        .success {
            color: #3a6b3a;
            background: #e8f8e8;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid #c8e8c8;
            font-family: 'Source Serif Pro', serif;
        }

        .hidden {
            display: none;
        }

        /* ITSM Dashboard Styles */
        .dashboard {
            background: #f5f1e8;
            background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            min-height: 100vh;
            font-family: 'Source Serif Pro', serif;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: #3a3226;
            color: #d4c9b8;
            padding: 20px 0;
            overflow-y: auto;
            border-right: 1px solid #5d4b36;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar .logo {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #5d4b36;
            margin-bottom: 20px;
        }

        .sidebar .logo h2 {
            color: #d4c9b8;
            margin: 0;
            font-size: 1.5em;
            font-family: 'Playfair Display', serif;
        }

        .sidebar .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: #d4c9b8;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            font-family: 'Playfair Display', serif;
        }

        .sidebar .nav-item:hover, .sidebar .nav-item.active {
            background: rgba(139, 107, 74, 0.2);
            color: #f5f1e8;
            border-left-color: #c2a582;
        }

        .sidebar .nav-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
            font-style: normal;
        }

        .main-wrapper {
            margin-left: 240px;
            min-height: 100vh;
        }

        .header {
            background: rgba(245, 241, 232, 0.9);
            border-bottom: 1px solid #d4c9b8;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-title {
            font-size: 1.5em;
            color: #5d4b36;
            margin: 0;
            font-family: 'Playfair Display', serif;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #d4c9b8;
            border-radius: 6px;
            padding: 8px 12px;
            width: 300px;
            transition: all 0.3s ease;
        }

        .search-box:hover {
            border-color: #8b6b4a;
        }

        .search-box input {
            border: none;
            background: none;
            outline: none;
            width: 100%;
            font-size: 14px;
            font-family: 'Source Serif Pro', serif;
            color: #3a3226;
        }

        .btn-primary {
            background: linear-gradient(to bottom, #8b6b4a, #6d563d);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Playfair Display', serif;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-primary:hover {
            background: linear-gradient(to bottom, #9a7b58, #7d6347);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Playfair Display', serif;
            color: #5d4b36;
        }

        .logout-btn {
            background: #8b2e2e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Playfair Display', serif;
        }

        .logout-btn:hover {
            background: #7a2626;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .main-content {
            padding: 30px;
        }

        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #d4c9b8;
            flex: 1;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #5d4b36;
            margin: 0;
            font-family: 'Playfair Display', serif;
        }

        .stat-label {
            color: #7a6b58;
            font-size: 0.9em;
            margin-top: 5px;
            font-style: italic;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid #d4c9b8;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header {
            background: rgba(245, 241, 232, 0.9);
            padding: 15px 20px;
            border-bottom: 1px solid #d4c9b8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #5d4b36;
            margin: 0;
            font-family: 'Playfair Display', serif;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-select {
            padding: 6px 12px;
            border: 1px solid #d4c9b8;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-family: 'Source Serif Pro', serif;
            color: #3a3226;
            transition: all 0.3s ease;
        }

        .filter-select:hover {
            border-color: #8b6b4a;
        }

        .filter-select:focus {
            outline: none;
            border-color: #8b6b4a;
            box-shadow: 0 0 0 3px rgba(139, 107, 74, 0.1);
        }

        .tickets-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Source Serif Pro', serif;
        }

        .tickets-table th {
            background: rgba(245, 241, 232, 0.9);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #5d4b36;
            border-bottom: 2px solid #d4c9b8;
            font-size: 14px;
            font-family: 'Playfair Display', serif;
        }

        .tickets-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9e0d2;
            font-size: 14px;
            color: #3a3226;
        }

        .tickets-table tr:hover {
            background: rgba(245, 241, 232, 0.5);
        }

        .priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            font-family: 'Playfair Display', serif;
        }

        .priority-p1 {
            background: #f8e8e8;
            color: #8b2e2e;
            border: 1px solid #e8c8c8;
        }

        .priority-p2 {
            background: #f8f0e8;
            color: #8b5a2e;
            border: 1px solid #e8d8c8;
        }

        .priority-p3 {
            background: #f8f0f0;
            color: #8b3a2e;
            border: 1px solid #e8d0c8;
        }

        .priority-p4 {
            background: #e8f8e8;
            color: #3a6b3a;
            border: 1px solid #c8e8c8;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            font-family: 'Playfair Display', serif;
        }

        .status-open {
            background: #e6f3ff;
            color: #2b6cb0;
            border: 1px solid #c8d8e8;
        }

        .status-closed {
            background: #f0f4f8;
            color: #4a5568;
            border: 1px solid #d8dce0;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(245, 241, 232, 0.9);
            border-top: 1px solid #d4c9b8;
        }

        .pagination-info {
            color: #7a6b58;
            font-size: 14px;
            font-style: italic;
        }

        .pagination-controls {
            display: flex;
            gap: 5px;
        }

        .page-btn {
            padding: 6px 12px;
            border: 1px solid #d4c9b8;
            background: rgba(255, 255, 255, 0.7);
            color: #5d4b36;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Playfair Display', serif;
        }

        .page-btn:hover {
            background: rgba(245, 241, 232, 0.9);
            border-color: #8b6b4a;
        }

        .page-btn.active {
            background: linear-gradient(to bottom, #8b6b4a, #6d563d);
            color: white;
            border-color: #6d563d;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #f5f1e8;
            background-image: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            margin: 5% auto;
            padding: 0;
            border: 1px solid #d4c9b8;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .modal-header {
            background: linear-gradient(to bottom, #8b6b4a, #6d563d);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Playfair Display', serif;
        }

        .modal-title {
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            transition: all 0.3s ease;
        }

        .close:hover {
            opacity: 0.7;
            transform: scale(1.1);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            padding: 20px 30px;
            border-top: 1px solid #d4c9b8;
            text-align: right;
            background: rgba(245, 241, 232, 0.9);
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
        }

        .form-col-full {
            width: 100%;
        }

        /* Dashboard specific styles */
        .dashboard-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid #d4c9b8;
        }

        .chart-toggle {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chart-btn {
            padding: 8px 16px;
            border: 1px solid #d4c9b8;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Playfair Display', serif;
        }

        .chart-btn.active {
            background: linear-gradient(to bottom, #8b6b4a, #6d563d);
            color: white;
            border-color: #6d563d;
        }

        .chart-btn:hover {
            background: rgba(245, 241, 232, 0.9);
            border-color: #8b6b4a;
        }

        .chart-btn.active:hover {
            background: linear-gradient(to bottom, #9a7b58, #7d6347);
        }

        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-filter select, .date-filter input {
            padding: 6px 12px;
            border: 1px solid #d4c9b8;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-family: 'Source Serif Pro', serif;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid #d4c9b8;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        .chart-wrapper.small {
            height: 250px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #5d4b36;
            margin-bottom: 15px;
            text-align: center;
            font-family: 'Playfair Display', serif;
        }

        .category-chart {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid #d4c9b8;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .category-chart .chart-wrapper {
            height: 300px;
        }

        /* Search highlighting */
        mark {
            background-color: #fff3cd;
            color: #856404;
            padding: 1px 2px;
            border-radius: 2px;
        }

        /* Search box enhancements */
        .search-box {
            position: relative;
        }

        .search-box input:focus {
            outline: none;
        }

        /* Assignee dropdown styling */
        select optgroup {
            font-weight: bold;
            font-style: normal;
            color: #5d4b36;
            background-color: rgba(245, 241, 232, 0.9);
            font-family: 'Playfair Display', serif;
        }

        select optgroup option {
            font-weight: normal;
            color: #3a3226;
            background-color: rgba(255, 255, 255, 0.9);
            padding-left: 10px;
            font-family: 'Source Serif Pro', serif;
        }

        /* Vintage paper effect for tables */
        .tickets-table {
            background: rgba(255, 255, 255, 0.7);
        }

        .tickets-table tr:nth-child(even) {
            background: rgba(245, 241, 232, 0.3);
        }

        /* Vintage scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f5f1e8;
        }

        ::-webkit-scrollbar-thumb {
            background: #8b6b4a;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6d563d;
        }

        /* Decorative elements */
        .vintage-border {
            border: 8px solid transparent;
            border-image: url('https://www.transparenttextures.com/patterns/old-map.png') 30 round;
        }

        /* Tooltip styles */
        [data-tooltip] {
            position: relative;
            cursor: pointer;
        }

        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #3a3226;
            color: #f5f1e8;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
            font-family: 'Source Serif Pro', serif;
        }

        /* New styles for enhanced charts */
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            font-family: 'Source Serif Pro', serif;
        }

        .chart-legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }

        .chart-legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            margin-right: 5px;
        }

        .chart-stats {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid #d4c9b8;
            font-family: 'Source Serif Pro', serif;
        }

        .chart-stats-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #5d4b36;
            font-family: 'Playfair Display', serif;
        }

        .chart-stats-item {
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        .chart-stats-value {
            font-weight: bold;
        }

        .sla-alert {
            background: #f8e8e8;
            border-left: 4px solid #8b2e2e;
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 4px;
            font-family: 'Source Serif Pro', serif;
        }

        .sla-alert-title {
            font-weight: bold;
            color: #8b2e2e;
            margin-bottom: 5px;
            font-family: 'Playfair Display', serif;
        }

        .top-performers-list {
            margin-top: 15px;
        }

        .top-performer {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9e0d2;
        }

        .top-performer-name {
            font-weight: bold;
            color: #5d4b36;
        }

        .top-performer-dept {
            font-style: italic;
            color: #7a6b58;
            font-size: 0.9em;
        }

        .top-performer-count {
            font-weight: bold;
            color: #8b6b4a;
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginForm" class="auth-container">
        <div class="logo">
            <h1>ITSM</h1>
            <p>Service Management Platform</p>
        </div>
        
        <div id="loginMessage"></div>
        
        <form id="loginFormElement">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" name="email" required>
            </div>
            
            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" name="password" required>
            </div>
            
            <button type="submit" class="btn">Login</button>
        </form>
        
        <div class="switch-form">
            <p>Don't have an account? <a href="#" onclick="showSignup()">Sign Up</a></p>
        </div>
    </div>

    <!-- Signup Form -->
    <div id="signupForm" class="auth-container hidden">
        <div class="logo">
            <h1>ITSM</h1>
            <p>Service Management Platform</p>
        </div>
        
        <div id="signupMessage"></div>
        
        <form id="signupFormElement">
            <div class="form-group">
                <label for="signupName">Full Name</label>
                <input type="text" id="signupName" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="signupEmail">Email</label>
                <input type="email" id="signupEmail" name="email" required>
            </div>
            
            <div class="form-group">
                <label for="signupDepartment">Department</label>
                <select id="signupDepartment" name="department" required>
                    <option value="">Select Department</option>
                    <option value="IT Department">IT Department</option>
                    <option value="Network Team">Network Team</option>
                    <option value="Security Team">Security Team</option>
                    <option value="Server Administration">Server Administration</option>
                    <option value="End User Support">End User Support</option>
                    <option value="Management">Management</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="signupPassword">Password</label>
                <input type="password" id="signupPassword" name="password" required>
            </div>
            
            <div class="form-group">
                <label for="signupConfirmPassword">Confirm Password</label>
                <input type="password" id="signupConfirmPassword" name="confirmPassword" required>
            </div>
            
            <button type="submit" class="btn">Sign Up</button>
        </form>
        
        <div class="switch-form">
            <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
        </div>
    </div>

    <!-- Create Ticket Modal -->
    <div id="createTicketModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Ticket</h2>
                <span class="close" onclick="closeCreateTicketModal()">&times;</span>
            </div>
            <form id="createTicketForm">
                <div class="modal-body">
                    <div id="createTicketMessage"></div>
                    
                    <div class="form-group">
                        <label for="ticketTitle">Title *</label>
                        <input type="text" id="ticketTitle" name="title" required placeholder="Enter ticket title">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="ticketSLA">SLA Priority *</label>
                            <select id="ticketSLA" name="sla" required>
                                <option value="">Select SLA Priority</option>
                                <option value="P1">P1 - Critical (4 hours)</option>
                                <option value="P2">P2 - High (8 hours)</option>
                                <option value="P3">P3 - Medium (24 hours)</option>
                                <option value="P4">P4 - Low (72 hours)</option>
                            </select>
                        </div>
                        
                        <div class="form-col">
                            <label for="ticketAssignee">Assignee</label>
                            <select id="ticketAssignee" name="assignee">
                                <option value="Unassigned">Unassigned</option>
                                <!-- Assignees will be populated dynamically -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="ticketCategory">Category *</label>
                            <select id="ticketCategory" name="category" required>
                                <option value="">Select Category</option>
                                <option value="Network">Network</option>
                                <option value="Security">Security</option>
                                <option value="Server">Server</option>
                                <option value="End User">End User</option>
                            </select>
                        </div>
                        
                        <div class="form-col">
                            <!-- Empty column for spacing -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="ticketDescription">Description *</label>
                        <textarea id="ticketDescription" name="description" required placeholder="Describe the issue in detail..."></textarea>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeCreateTicketModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create Ticket</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ITSM Dashboard -->
    <div id="dashboard" class="dashboard hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h2>ITSM Pro</h2>
            </div>
            <nav>
                <a href="#" class="nav-item active" data-section="helpdesk">
                    <i>📋</i>
                    <span>Help Desk</span>
                </a>
                <a href="#" class="nav-item" data-section="dashboard">
                    <i>📊</i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="inventory">
                    <i>💻</i>
                    <span>Inventory</span>
                </a>
                <a href="#" class="nav-item" data-section="users">
                    <i>👥</i>
                    <span>Users</span>
                </a>
                <a href="#" class="nav-item" data-section="reports">
                    <i>📊</i>
                    <span>Reports</span>
                </a>
                <a href="#" class="nav-item" data-section="admin">
                    <i>🔧</i>
                    <span>Admin</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i>⚙️</i>
                    <span>Settings</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-wrapper">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <h1 class="header-title">Help Desk</h1>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search tickets...">
                        <i>🔍</i>
                    </div>
                    <button class="btn-primary" onclick="openCreateTicketModal()">+ New Ticket</button>
                    <div class="user-info">
                        <span>Welcome, <span id="userName"></span></span>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Help Desk Section -->
                <div id="helpdesk" class="content-section-wrapper">
                    <!-- Stats Bar -->
                    <div class="stats-bar">
                        <div class="stat-item">
                            <div class="stat-number" id="openTicketsCount">0</div>
                            <div class="stat-label">Open Tickets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="totalTicketsCount">0</div>
                            <div class="stat-label">Total Tickets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="closedTicketsCount">0</div>
                            <div class="stat-label">Closed Tickets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="avgResponseTime">0h</div>
                            <div class="stat-label">Avg Response</div>
                        </div>
                    </div>

                    <!-- Tickets Table -->
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">All Tickets</h2>
                            <div class="filter-controls">
                                <select class="filter-select" id="priorityFilter">
                                    <option>All Tickets</option>
                                    <option>P1 Priority</option>
                                    <option>P2 Priority</option>
                                    <option>P3 Priority</option>
                                    <option>P4 Priority</option>
                                </select>
                                <select class="filter-select" id="statusFilter">
                                    <option>All Status</option>
                                    <option>Open</option>
                                    <option>In Progress</option>
                                    <option>Resolved</option>
                                    <option>Closed</option>
                                </select>
                            </div>
                        </div>
                        
                        <table class="tickets-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Assignee</th>
                                    <th>Creator</th>
                                    <th>Category</th>
                                    <th>SLA Priority</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Updated</th>
                                    <th>Time Remaining</th>
                                </tr>
                            </thead>
                            <tbody id="ticketsTableBody">
                                <!-- Tickets will be populated here -->
                            </tbody>
                        </table>
                        
                        <div class="pagination">
                            <div class="pagination-info" id="paginationInfo">
                                Showing 0 tickets
                            </div>
                            <div class="pagination-controls">
                                <button class="page-btn">Previous</button>
                                <button class="page-btn active">1</button>
                                <button class="page-btn">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section-wrapper" style="display: none;">
                    <div class="stats-bar">
                        <div class="stat-item">
                            <div class="stat-number" id="dashOpenTickets">0</div>
                            <div class="stat-label">Open Tickets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="dashTotalTickets">0</div>
                            <div class="stat-label">Total Tickets</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="dashP1Tickets">0</div>
                            <div class="stat-label">P1 Critical</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="dashClosedTickets">0</div>
                            <div class="stat-label">Closed Today</div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Controls -->
                    <div class="dashboard-controls">
                        <div class="date-filter">
                            <label>Time Period:</label>
                            <select id="dateFilter">
                                <option value="24h">Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <input type="date" id="startDate" style="display: none;">
                            <input type="date" id="endDate" style="display: none;">
                        </div>
                        
                        <button class="btn-primary" onclick="exportDashboard()">
                            <span>📊 Export Executive Dashboard</span>
                        </button>
                    </div>
                    
                    <!-- Main Charts Grid -->
                    <div class="chart-grid">
                        <!-- Main Ticket Status Chart -->
                        <div class="chart-container">
                            <div class="chart-title">Ticket Status Distribution</div>
                            <div class="chart-wrapper">
                                <canvas id="mainChart"></canvas>
                            </div>
                            <div id="mainChartStats" class="chart-stats"></div>
                        </div>
                        
                        <!-- SLA Timeline Chart -->
                        <div class="chart-container">
                            <div class="chart-title">SLA Timeline</div>
                            <div class="chart-wrapper small">
                                <canvas id="slaChart"></canvas>
                            </div>
                            <div id="slaChartStats" class="chart-stats"></div>
                            <div id="slaAlert" class="sla-alert" style="display: none;">
                                <div class="sla-alert-title">🚨 Critical Alert</div>
                                <div id="slaAlertContent"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Performers Chart -->
                    <div class="chart-container">
                        <div class="chart-title">Top Performers</div>
                        <div class="chart-wrapper">
                            <canvas id="performersChart"></canvas>
                        </div>
                        <div class="top-performers-list" id="topPerformersList"></div>
                    </div>
                    
                    <!-- Category Breakdown Horizontal Bar Chart -->
                    <div class="category-chart">
                        <div class="chart-title">Department Wise Ticket Distribution</div>
                        <div class="chart-wrapper">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Other sections placeholder -->
                <div id="inventory" class="content-section-wrapper" style="display: none;">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Inventory Management</h2>
                        </div>
                        <div style="padding: 20px; text-align: center;">
                            <h3>Inventory Module</h3>
                            <p>Asset management functionality will be available here.</p>
                        </div>
                    </div>
                </div>

                <div id="users" class="content-section-wrapper" style="display: none;">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">User Management</h2>
                        </div>
                        <div style="padding: 20px; text-align: center;">
                            <h3>User Management</h3>
                            <p>User administration features will be available here.</p>
                        </div>
                    </div>
                </div>

                <div id="reports" class="content-section-wrapper" style="display: none;">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Reports</h2>
                        </div>
                        <div style="padding: 20px; text-align: center;">
                            <h3>Reporting Module</h3>
                            <p>Advanced reporting and analytics will be available here.</p>
                        </div>
                    </div>
                </div>

                <div id="admin" class="content-section-wrapper" style="display: none;">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Admin Panel</h2>
                        </div>
                        <div style="padding: 20px; text-align: center;">
                            <h3>Administration</h3>
                            <p>System administration tools will be available here.</p>
                        </div>
                    </div>
                </div>

                <div id="settings" class="content-section-wrapper" style="display: none;">
                    <div class="content-section">
                        <div class="section-header">
                            <h2 class="section-title">Settings</h2>
                        </div>
                        <div style="padding: 20px; text-align: center;">
                            <h3>System Settings</h3>
                            <p>Configuration options will be available here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // In-memory storage for user data and tickets
        let users = [];
        let tickets = [];
        let currentUser = null;
        let ticketIdCounter = 1;

        // Chart instances
        let mainChart, slaChart, categoryChart, performersChart;

        // LocalStorage functions
        function saveDataToLocalStorage() {
            localStorage.setItem('itsmUsers', JSON.stringify(users));
            localStorage.setItem('itsmTickets', JSON.stringify(tickets));
            localStorage.setItem('itsmTicketIdCounter', ticketIdCounter.toString());
            if (currentUser) {
                localStorage.setItem('itsmCurrentUser', JSON.stringify(currentUser));
            }
        }

        function loadDataFromLocalStorage() {
            const storedUsers = localStorage.getItem('itsmUsers');
            const storedTickets = localStorage.getItem('itsmTickets');
            const storedTicketIdCounter = localStorage.getItem('itsmTicketIdCounter');
            const storedCurrentUser = localStorage.getItem('itsmCurrentUser');

            if (storedUsers) {
                users = JSON.parse(storedUsers);
            }

            if (storedTickets) {
                tickets = JSON.parse(storedTickets);
                // Convert date strings back to Date objects
                tickets.forEach(ticket => {
                    ticket.createdAt = new Date(ticket.createdAt);
                    ticket.updatedAt = new Date(ticket.updatedAt);
                });
            }

            if (storedTicketIdCounter) {
                ticketIdCounter = parseInt(storedTicketIdCounter);
            }

            if (storedCurrentUser) {
                currentUser = JSON.parse(storedCurrentUser);
            }
        }

        function clearLocalStorage() {
            localStorage.removeItem('itsmUsers');
            localStorage.removeItem('itsmTickets');
            localStorage.removeItem('itsmTicketIdCounter');
            localStorage.removeItem('itsmCurrentUser');
        }

        // Load data from localStorage on page load
        loadDataFromLocalStorage();

        // Check if user is already logged in
        if (currentUser) {
            showDashboard();
        } else {
            showLogin();
        }

        // Show/Hide forms
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            clearMessages();
        }

        function showSignup() {
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            clearMessages();
        }

        function showDashboard() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.body.style.background = '#f5f1e8';
            
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name;
            }
            
            // Initialize components
            setTimeout(() => {
                initializeSidebar();
                initializeFilters();
                loadTickets();
                updateStats();
                initializeCharts(); // Initialize charts with animations
                updateDashboardStats();
                updateCountdowns(); // Initialize countdowns
            }, 100);
        }

        function clearMessages() {
            document.getElementById('loginMessage').innerHTML = '';
            document.getElementById('signupMessage').innerHTML = '';
        }

        function showMessage(elementId, message, type) {
            const messageElement = document.getElementById(elementId);
            messageElement.innerHTML = `<div class="${type}">${message}</div>`;
        }

        // Populate assignee dropdown with registered users
        function populateAssigneeDropdown() {
            const assigneeSelect = document.getElementById('ticketAssignee');
            if (!assigneeSelect) return;
            
            // Clear existing options except "Unassigned"
            assigneeSelect.innerHTML = '<option value="Unassigned">Unassigned</option>';
            
            // Group users by department
            const departments = {};
            users.forEach(user => {
                if (!departments[user.department]) {
                    departments[user.department] = [];
                }
                departments[user.department].push(user);
            });
            
            // Add options grouped by department
            Object.keys(departments).sort().forEach(dept => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = dept;
                
                departments[dept].sort((a, b) => a.name.localeCompare(b.name)).forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.name;
                    option.textContent = `${user.name} (${user.email})`;
                    optgroup.appendChild(option);
                });
                
                assigneeSelect.appendChild(optgroup);
            });
        }

        // Modal functions
        function openCreateTicketModal() {
            document.getElementById('createTicketModal').style.display = 'block';
            document.getElementById('createTicketForm').reset();
            document.getElementById('createTicketMessage').innerHTML = '';
            
            // Populate assignee dropdown with current users
            populateAssigneeDropdown();
        }

        function closeCreateTicketModal() {
            document.getElementById('createTicketModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Sidebar navigation
        function openSection(section) {
            const sections = document.querySelectorAll('.content-section-wrapper');
            sections.forEach(sec => sec.style.display = 'none');

            if (section === 'dashboard') {
                document.getElementById('dashboard-section').style.display = 'block';
                updateDashboardStats();
            } else {
                const activeSection = document.getElementById(section);
                if (activeSection) activeSection.style.display = 'block';
            }
        }

        // Initialize sidebar navigation after DOM is loaded
        function initializeSidebar() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelector('.nav-item.active').classList.remove('active');
                    this.classList.add('active');
                    openSection(this.dataset.section);
                });
            });
        }

        // Initialize chart data and configurations with animations
        function initializeCharts() {
            const mainCtx = document.getElementById('mainChart').getContext('2d');
            const slaCtx = document.getElementById('slaChart').getContext('2d');
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            const performersCtx = document.getElementById('performersChart').getContext('2d');

            // Main Ticket Status Chart with animation
            mainChart = new Chart(mainCtx, {
                type: 'pie',
                data: {
                    labels: ['Open', 'Closed', 'In Progress', 'Resolved'],
                    datasets: [{
                        label: 'Ticket Status',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1,
                        hoverOffset: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 2000,
                        easing: 'easeOutElastic',
                        onComplete: () => {
                            // Pulse effect when animation completes
                            const chartInstance = this.chart;
                            const ctx = chartInstance.ctx;
                            ctx.save();
                            ctx.shadowBlur = 20;
                            ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                            ctx.restore();
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: "'Playfair Display', serif",
                                    size: 12
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(58, 50, 38, 0.9)',
                            titleFont: {
                                family: "'Playfair Display', serif",
                                size: 14
                            },
                            bodyFont: {
                                family: "'Source Serif Pro', serif",
                                size: 12
                            },
                            padding: 12,
                            cornerRadius: 6,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });

            // SLA Timeline Chart with animation
            slaChart = new Chart(slaCtx, {
                type: 'doughnut',
                data: {
                    labels: ['P1 - Critical', 'P2 - High', 'P3 - Medium', 'P4 - Low'],
                    datasets: [{
                        label: 'SLA Timeline',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(255, 205, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1500,
                        easing: 'easeOutBounce'
                    },
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    family: "'Playfair Display', serif",
                                    size: 12
                                },
                                padding: 10
                            }
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const slaData = slaChartStats;
                                    const sla = context.label.split(' - ')[0];
                                    let additionalInfo = '';
                                    
                                    if (slaData[sla]) {
                                        const met = slaData[sla].met || 0;
                                        const breached = slaData[sla].breached || 0;
                                        const total = met + breached;
                                        const compliance = total > 0 ? Math.round((met / total) * 100) : 0;
                                        
                                        additionalInfo = `\n\n${sla} Compliance:\n${met}/${total} Met (${compliance}%)\n${breached} Breached`;
                                    }
                                    
                                    return additionalInfo;
                                }
                            }
                        }
                    },
                    cutout: '70%'
                }
            });

            // Top Performers Chart
            performersChart = new Chart(performersCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Tickets Resolved',
                        data: [],
                        backgroundColor: 'rgba(139, 107, 74, 0.7)',
                        borderColor: 'rgba(139, 107, 74, 1)',
                        borderWidth: 1,
                        borderRadius: 6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const performer = topPerformersData.find(p => p.name === context.label);
                                    return performer ? `Department: ${performer.department}` : '';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Source Serif Pro', serif"
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Playfair Display', serif",
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });

            // Category Breakdown Chart with animation
            categoryChart = new Chart(categoryCtx, {
                type: 'bar',
                data: {
                    labels: ['End User', 'Network', 'Security', 'Server'],
                    datasets: [{
                        label: 'Tickets by Department',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(255, 159, 64, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 99, 132, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1,
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: {
                        duration: 2000,
                        easing: 'easeOutQuart',
                        delay: (context) => {
                            if (context.type === 'data' && context.mode === 'default') {
                                return context.dataIndex * 300;
                            }
                            return 0;
                        },
                        onComplete: (animation) => {
                            // Bar growing animation
                            const chartInstance = animation.chart;
                            const ctx = chartInstance.ctx;
                            ctx.save();
                            const meta = chartInstance.getDatasetMeta(0);
                            
                            meta.data.forEach((bar, index) => {
                                const model = bar;
                                const x = model.x;
                                const y = model.y;
                                const width = model.width;
                                const height = model.height;
                                
                                ctx.globalCompositeOperation = 'destination-over';
                                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                                ctx.shadowBlur = 10;
                                ctx.shadowOffsetX = 3;
                                ctx.shadowOffsetY = 3;
                                ctx.fillStyle = model.options.backgroundColor;
                                ctx.fillRect(x - width / 2, y - height / 2, width, height);
                            });
                            
                            ctx.restore();
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(58, 50, 38, 0.9)',
                            titleFont: {
                                family: "'Playfair Display', serif",
                                size: 14
                            },
                            bodyFont: {
                                family: "'Source Serif Pro', serif",
                                size: 12
                            },
                            padding: 12,
                            cornerRadius: 6
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Source Serif Pro', serif"
                                }
                            }
                        },
                        y: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                font: {
                                    family: "'Playfair Display', serif",
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });
        }

        // Variables to store chart stats
        let mainChartStats = {};
        let slaChartStats = {};
        let topPerformersData = [];

        // Export dashboard as PDF
        function exportDashboard() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape');
            
            // Add title
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(24);
            doc.setTextColor(58, 50, 38);
            doc.text('ITSM Executive Dashboard', 148, 20, { align: 'center' });
            
            // Add date
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.text(`Exported on: ${new Date().toLocaleString()}`, 148, 28, { align: 'center' });
            
            // Add charts as images
            const charts = [
                { id: 'mainChart', title: 'Ticket Status Distribution', x: 20, y: 40, width: 120, height: 80 },
                { id: 'slaChart', title: 'SLA Compliance', x: 160, y: 40, width: 120, height: 80 },
                { id: 'performersChart', title: 'Top Performers', x: 20, y: 140, width: 120, height: 80 },
                { id: 'categoryChart', title: 'Department Distribution', x: 160, y: 140, width: 120, height: 80 }
            ];
            
            let promises = charts.map(chart => {
                return html2canvas(document.getElementById(chart.id)).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    doc.addImage(imgData, 'PNG', chart.x, chart.y, chart.width, chart.height);
                    doc.setFontSize(14);
                    doc.text(chart.title, chart.x + chart.width/2, chart.y - 5, { align: 'center' });
                });
            });
            
            // Wait for all charts to be added
            Promise.all(promises).then(() => {
                // Add stats section
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                // Main stats
                doc.text('Key Statistics:', 20, 130);
                doc.text(`Open Tickets: ${document.getElementById('dashOpenTickets').textContent}`, 30, 140);
                doc.text(`Total Tickets: ${document.getElementById('dashTotalTickets').textContent}`, 30, 150);
                doc.text(`P1 Critical Tickets: ${document.getElementById('dashP1Tickets').textContent}`, 30, 160);
                doc.text(`Closed Tickets: ${document.getElementById('dashClosedTickets').textContent}`, 30, 170);
                
                // SLA stats
                doc.text('SLA Compliance:', 160, 130);
                let slaY = 140;
                Object.keys(slaChartStats).forEach(sla => {
                    const stats = slaChartStats[sla];
                    const total = stats.met + stats.breached;
                    const compliance = total > 0 ? Math.round((stats.met / total) * 100) : 0;
                    doc.text(`${sla}: ${compliance}% (${stats.met}/${total} met)`, 170, slaY);
                    slaY += 10;
                });
                
                // Top performers
                doc.text('Top Performers:', 20, 230);
                let performerY = 240;
                topPerformersData.slice(0, 5).forEach(performer => {
                    doc.text(`${performer.name} (${performer.department}): ${performer.count}`, 30, performerY);
                    performerY += 10;
                });
                
                // Save the PDF
                doc.save(`ITSM-Dashboard-${new Date().toISOString().slice(0,10)}.pdf`);
            });
        }

        // Initialize filters
        function initializeFilters() {
            const priorityFilter = document.getElementById('priorityFilter');
            const statusFilter = document.getElementById('statusFilter');
            const dateFilter = document.getElementById('dateFilter');
            const searchInput = document.getElementById('searchInput');

            if (priorityFilter) {
                priorityFilter.addEventListener('change', loadTickets);
            }
            if (statusFilter) {
                statusFilter.addEventListener('change', loadTickets);
            }
            if (dateFilter) {
                dateFilter.addEventListener('change', handleDateChange);
            }
            if (searchInput) {
                // Add real-time search functionality
                searchInput.addEventListener('input', debounce(loadTickets, 300));
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        loadTickets();
                    }
                });
            }
        }

        // Debounce function to limit search frequency
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Handle date filter changes
        function handleDateChange() {
            const dateFilter = document.getElementById('dateFilter');
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');

            if (dateFilter.value === 'custom') {
                startDate.style.display = 'inline';
                endDate.style.display = 'inline';
            } else {
                startDate.style.display = 'none';
                endDate.style.display = 'none';
            }

            // Redraw charts with the filtered data
            updateDashboardStats();
        }

        // Calculate due date based on SLA
        function calculateDueDate(ticket) {
            const createdDate = new Date(ticket.createdAt);
            let hoursToAdd = 4; // Default P1
            
            switch(ticket.sla) {
                case 'P2': hoursToAdd = 8; break;
                case 'P3': hoursToAdd = 24; break;
                case 'P4': hoursToAdd = 72; break;
            }
            
            return new Date(createdDate.getTime() + (hoursToAdd * 60 * 60 * 1000));
        }

        // Update countdown timers for all tickets
        function updateCountdowns() {
            const now = new Date();
            document.querySelectorAll('.countdown-cell').forEach(cell => {
                const dueDate = new Date(cell.dataset.due);
                const diff = dueDate - now;
                
                if (diff <= 0) {
                    cell.textContent = 'Overdue';
                    cell.style.color = '#8b2e2e';
                    cell.style.fontWeight = 'bold';
                } else {
                    const hours = Math.floor(diff / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    cell.textContent = `${hours}h ${minutes}m ${seconds}s`;
                    
                    // Color coding based on urgency
                    if (hours < 2) {
                        cell.style.color = '#8b2e2e';
                    } else if (hours < 4) {
                        cell.style.color = '#8b5a2e';
                    } else {
                        cell.style.color = '#3a6b3a';
                    }
                }
            });
        }

        // Handle create ticket form submission
        document.getElementById('createTicketForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const title = formData.get('title');
            const sla = formData.get('sla');
            const category = formData.get('category');
            const description = formData.get('description');
            const assignee = formData.get('assignee') || 'Unassigned';
            
            // Validation
            if (!title || !sla || !category || !description) {
                showMessage('createTicketMessage', 'Please fill in all required fields!', 'error');
                return;
            }
            
            // Create new ticket
            const newTicket = {
                id: ticketIdCounter++,
                title: title,
                sla: sla,
                category: category,
                description: description,
                assignee: assignee,
                creator: currentUser.name,
                status: 'Open',
                createdAt: new Date(),
                updatedAt: new Date()
            };
            
            tickets.push(newTicket);

            saveDataToLocalStorage(); // Save tickets to localStorage
            showMessage('createTicketMessage', 'Ticket created successfully!', 'success');
            
            // Close modal after 1 second and refresh tickets
            setTimeout(() => {
                closeCreateTicketModal();
                loadTickets();
                updateStats();
                updateDashboardStats(); // Also update charts
            }, 1000);
        });

        // Load and display tickets
        function loadTickets() {
            const priorityFilter = document.getElementById('priorityFilter');
            const statusFilter = document.getElementById('statusFilter');
            const searchInput = document.getElementById('searchInput');
            
            const filterPriority = priorityFilter ? priorityFilter.value : 'All Tickets';
            const filterStatus = statusFilter ? statusFilter.value : 'All Status';
            const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
            
            const tbody = document.getElementById('ticketsTableBody');
            tbody.innerHTML = '';
            
            // Filter tickets based on selected criteria
            let filteredTickets = tickets;
            
            // Filter by search term
            if (searchTerm) {
                filteredTickets = filteredTickets.filter(ticket => 
                    ticket.title.toLowerCase().includes(searchTerm) ||
                    ticket.description.toLowerCase().includes(searchTerm) ||
                    ticket.creator.toLowerCase().includes(searchTerm) ||
                    ticket.assignee.toLowerCase().includes(searchTerm) ||
                    ticket.category.toLowerCase().includes(searchTerm) ||
                    ticket.sla.toLowerCase().includes(searchTerm) ||
                    ticket.status.toLowerCase().includes(searchTerm) ||
                    ticket.id.toString().includes(searchTerm)
                );
            }
            
            // Filter by priority
            if (filterPriority !== 'All Tickets') {
                const priority = filterPriority.split(' ')[0]; // Extract P1, P2, etc.
                filteredTickets = filteredTickets.filter(ticket => ticket.sla === priority);
            }
            
            // Filter by status
            if (filterStatus !== 'All Status') {
                filteredTickets = filteredTickets.filter(ticket => ticket.status === filterStatus);
            }
            
            // Display filtered tickets
            if (filteredTickets.length === 0) {
                // Show no results message
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="10" style="text-align: center; padding: 20px; color: #666; font-style: italic;">
                        ${searchTerm ? `No tickets found matching "${searchTerm}"` : 'No tickets match the selected filters'}
                    </td>
                `;
                tbody.appendChild(row);
            } else {
                filteredTickets.forEach(ticket => {
                    const row = document.createElement('tr');
                    const createdDate = formatDate(ticket.createdAt);
                    const updatedDate = formatDate(ticket.updatedAt);
                    const dueDate = calculateDueDate(ticket);
                    
                    // Highlight search term in ticket title if searching
                    let displayTitle = ticket.title;
                    if (searchTerm && ticket.title.toLowerCase().includes(searchTerm)) {
                        const regex = new RegExp(`(${searchTerm})`, 'gi');
                        displayTitle = ticket.title.replace(regex, '<mark>$1</mark>');
                    }
                    
                    row.innerHTML = `
                        <td>${ticket.id}</td>
                        <td>${displayTitle}</td>
                        <td>${ticket.assignee}</td>
                        <td>${ticket.creator}</td>
                        <td>${ticket.category}</td>
                        <td><span class="priority-badge priority-${ticket.sla.toLowerCase()}">${ticket.sla}</span></td>
                        <td><span class="status-badge status-${ticket.status.toLowerCase().replace(' ', '-')}">${ticket.status}</span></td>
                        <td>${createdDate}</td>
                        <td>${updatedDate}</td>
                        <td class="countdown-cell" data-due="${dueDate.toISOString()}">Calculating...</td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                // Initialize countdowns for the displayed tickets
                updateCountdowns();
            }
            
            // Update pagination info
            const paginationInfo = document.getElementById('paginationInfo');
            paginationInfo.textContent = `Showing ${filteredTickets.length} of ${tickets.length} tickets`;
        }

        // Update stats
        function updateStats() {
            const openTickets = tickets.filter(ticket => ticket.status === 'Open').length;
            const closedTickets = tickets.filter(ticket => ticket.status === 'Closed').length;
            const totalTickets = tickets.length;
            
            // Update Help Desk stats
            const openCountEl = document.getElementById('openTicketsCount');
            const totalCountEl = document.getElementById('totalTicketsCount');
            const closedCountEl = document.getElementById('closedTicketsCount');
            
            if (openCountEl) openCountEl.textContent = openTickets;
            if (totalCountEl) totalCountEl.textContent = totalTickets;
            if (closedCountEl) closedCountEl.textContent = closedTickets;
        }

        // Filter tickets by date range
        function filterTicketsByDate(tickets) {
            const dateFilter = document.getElementById('dateFilter');
            const startDate = document.getElementById('startDate');
            const endDate = document.getElementById('endDate');
            
            if (!dateFilter) return tickets;
            
            const now = new Date();
            let filteredTickets = tickets;
            
            switch (dateFilter.value) {
                case '24h':
                    const last24Hours = new Date(now.getTime() - 24 * 60 * 60 * 1000);
                    filteredTickets = tickets.filter(ticket => new Date(ticket.createdAt) >= last24Hours);
                    break;
                case '7d':
                    const last7Days = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredTickets = tickets.filter(ticket => new Date(ticket.createdAt) >= last7Days);
                    break;
                case '30d':
                    const last30Days = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    filteredTickets = tickets.filter(ticket => new Date(ticket.createdAt) >= last30Days);
                    break;
                case 'custom':
                    if (startDate.value && endDate.value) {
                        const start = new Date(startDate.value);
                        const end = new Date(endDate.value);
                        filteredTickets = tickets.filter(ticket => {
                            const ticketDate = new Date(ticket.createdAt);
                            return ticketDate >= start && ticketDate <= end;
                        });
                    }
                    break;
            }
            
            return filteredTickets;
        }

        // Update dashboard stats with animations
        function updateDashboardStats() {
            const filteredTickets = filterTicketsByDate(tickets);
            
            const openTickets = filteredTickets.filter(ticket => ticket.status === 'Open').length;
            const closedTickets = filteredTickets.filter(ticket => ticket.status === 'Closed').length;
            const inProgressTickets = filteredTickets.filter(ticket => ticket.status === 'In Progress').length;
            const resolvedTickets = filteredTickets.filter(ticket => ticket.status === 'Resolved').length;
            const totalTickets = filteredTickets.length;
            
            const p1Tickets = filteredTickets.filter(ticket => ticket.sla === 'P1').length;
            const p2Tickets = filteredTickets.filter(ticket => ticket.sla === 'P2').length;
            const p3Tickets = filteredTickets.filter(ticket => ticket.sla === 'P3').length;
            const p4Tickets = filteredTickets.filter(ticket => ticket.sla === 'P4').length;
            
            // Count tickets by category
            const categoryBreakdown = {
                'End User': filteredTickets.filter(ticket => ticket.category === 'End User').length,
                'Network': filteredTickets.filter(ticket => ticket.category === 'Network').length,
                'Security': filteredTickets.filter(ticket => ticket.category === 'Security').length,
                'Server': filteredTickets.filter(ticket => ticket.category === 'Server').length
            };
            
            // Calculate SLA compliance
            const slaCompliance = {
                'P1': { met: 0, breached: 0 },
                'P2': { met: 0, breached: 0 },
                'P3': { met: 0, breached: 0 },
                'P4': { met: 0, breached: 0 }
            };
            
            filteredTickets.forEach(ticket => {
                if (ticket.status === 'Closed') {
                    const dueDate = calculateDueDate(ticket);
                    if (ticket.updatedAt <= dueDate) {
                        slaCompliance[ticket.sla].met++;
                    } else {
                        slaCompliance[ticket.sla].breached++;
                    }
                }
            });
            
            // Calculate top performers
            const performers = {};
            filteredTickets.forEach(ticket => {
                if (ticket.status === 'Closed' && ticket.assignee !== 'Unassigned') {
                    if (!performers[ticket.assignee]) {
                        performers[ticket.assignee] = { count: 0, department: '' };
                    }
                    performers[ticket.assignee].count++;
                    
                    // Find department of the assignee
                    if (!performers[ticket.assignee].department) {
                        const user = users.find(u => u.name === ticket.assignee);
                        if (user) {
                            performers[ticket.assignee].department = user.department;
                        }
                    }
                }
            });
            
            // Convert to array and sort
            topPerformersData = Object.keys(performers).map(name => ({
                name,
                count: performers[name].count,
                department: performers[name].department
            })).sort((a, b) => b.count - a.count);
            
            // Update dashboard elements
            const dashOpenEl = document.getElementById('dashOpenTickets');
            const dashTotalEl = document.getElementById('dashTotalTickets');
            const dashP1El = document.getElementById('dashP1Tickets');
            const dashClosedEl = document.getElementById('dashClosedTickets');
            
            if (dashOpenEl) dashOpenEl.textContent = openTickets;
            if (dashTotalEl) dashTotalEl.textContent = totalTickets;
            if (dashP1El) dashP1El.textContent = p1Tickets;
            if (dashClosedEl) dashClosedEl.textContent = closedTickets;
            
            // Update main chart stats
            mainChartStats = {
                'Open': openTickets,
                'Closed': closedTickets,
                'In Progress': inProgressTickets,
                'Resolved': resolvedTickets
            };
            
            // Update SLA chart stats
            slaChartStats = slaCompliance;
            
            // Update charts with animation
            if (mainChart) {
                // Animate the main chart
                mainChart.data.datasets[0].data = [openTickets, closedTickets, inProgressTickets, resolvedTickets];
                mainChart.update({
                    duration: 1000,
                    easing: 'easeOutBounce'
                });
                
                // Update main chart stats display
                const total = openTickets + closedTickets + inProgressTickets + resolvedTickets;
                let statsHTML = '<div class="chart-stats-title">Ticket Status Breakdown</div>';
                
                ['Open', 'Closed', 'In Progress', 'Resolved'].forEach(status => {
                    const count = mainChartStats[status] || 0;
                    const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                    const color = {
                        'Open': '#4BC0C0',
                        'Closed': '#36A2EB',
                        'In Progress': '#FFCE56',
                        'Resolved': '#9966FF'
                    }[status];
                    
                    statsHTML += `
                        <div class="chart-stats-item">
                            <span>
                                <span style="display: inline-block; width: 10px; height: 10px; background-color: ${color}; margin-right: 5px;"></span>
                                ${status}
                            </span>
                            <span class="chart-stats-value">${count} (${percentage}%)</span>
                        </div>
                    `;
                });
                
                document.getElementById('mainChartStats').innerHTML = statsHTML;
            }
            
            if (slaChart) {
                // Animate the SLA chart with a delay
                setTimeout(() => {
                    slaChart.data.datasets[0].data = [p1Tickets, p2Tickets, p3Tickets, p4Tickets];
                    slaChart.update({
                        duration: 800,
                        easing: 'easeOutElastic'
                    });
                    
                    // Update SLA chart stats display
                    let statsHTML = '<div class="chart-stats-title">SLA Compliance</div>';
                    let totalMet = 0;
                    let totalBreached = 0;
                    
                    ['P1', 'P2', 'P3', 'P4'].forEach(sla => {
                        const met = slaCompliance[sla].met || 0;
                        const breached = slaCompliance[sla].breached || 0;
                        const total = met + breached;
                        const compliance = total > 0 ? Math.round((met / total) * 100) : 0;
                        const color = {
                            'P1': '#FF6384',
                            'P2': '#FF9F40',
                            'P3': '#FFCD56',
                            'P4': '#4BC0C0'
                        }[sla];
                        
                        statsHTML += `
                            <div class="chart-stats-item">
                                <span>
                                    <span style="display: inline-block; width: 10px; height: 10px; background-color: ${color}; margin-right: 5px;"></span>
                                    ${sla}
                                </span>
                                <span class="chart-stats-value">${compliance}% (${met}/${total})</span>
                            </div>
                        `;
                        
                        totalMet += met;
                        totalBreached += breached;
                    });
                    
                    const overallTotal = totalMet + totalBreached;
                    const overallCompliance = overallTotal > 0 ? Math.round((totalMet / overallTotal) * 100) : 0;
                    
                    statsHTML += `
                        <div class="chart-stats-item" style="margin-top: 10px; border-top: 1px solid #d4c9b8; padding-top: 5px;">
                            <span style="font-weight: bold;">Overall Compliance</span>
                            <span class="chart-stats-value" style="font-weight: bold;">${overallCompliance}% (${totalMet}/${overallTotal})</span>
                        </div>
                    `;
                    
                    document.getElementById('slaChartStats').innerHTML = statsHTML;
                    
                    // Show critical alert if P1 compliance is low
                    const p1Compliance = p1Tickets > 0 ? Math.round((slaCompliance.P1.met / p1Tickets) * 100) : 100;
                    if (p1Compliance < 50) {
                        document.getElementById('slaAlert').style.display = 'block';
                        document.getElementById('slaAlertContent').innerHTML = `
                            Only ${p1Compliance}% of P1 tickets met SLA (${slaCompliance.P1.met}/${p1Tickets}).
                            Immediate attention required.
                        `;
                    } else {
                        document.getElementById('slaAlert').style.display = 'none';
                    }
                }, 300);
            }
            
            if (performersChart) {
                // Update top performers chart
                const topPerformers = topPerformersData.slice(0, 5);
                performersChart.data.labels = topPerformers.map(p => p.name);
                performersChart.data.datasets[0].data = topPerformers.map(p => p.count);
                performersChart.update({
                    duration: 1000,
                    easing: 'easeOutQuart'
                });
                
                // Update top performers list
                let performersHTML = '';
                topPerformersData.slice(0, 5).forEach(performer => {
                    performersHTML += `
                        <div class="top-performer">
                            <div>
                                <span class="top-performer-name">${performer.name}</span>
                                <span class="top-performer-dept">(${performer.department})</span>
                            </div>
                            <span class="top-performer-count">${performer.count}</span>
                        </div>
                    `;
                });
                document.getElementById('topPerformersList').innerHTML = performersHTML;
            }
            
            if (categoryChart) {
                // Animate the category chart with a longer delay
                setTimeout(() => {
                    categoryChart.data.datasets[0].data = [
                        categoryBreakdown['End User'],
                        categoryBreakdown['Network'],
                        categoryBreakdown['Security'],
                        categoryBreakdown['Server']
                    ];
                    categoryChart.update({
                        duration: 1200,
                        easing: 'easeOutQuart'
                    });
                }, 600);
            }
        }

        // Format date for display
        function formatDate(date) {
            const now = new Date();
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 60) {
                return `${diffInMinutes}m ago`;
            } else if (diffInMinutes < 1440) {
                return `${Math.floor(diffInMinutes / 60)}h ago`;
            } else {
                return `${Math.floor(diffInMinutes / 1440)}d ago`;
            }
        }

        // Handle signup
        document.getElementById('signupFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const name = formData.get('name');
            const email = formData.get('email');
            const department = formData.get('department');
            const password = formData.get('password');
            const confirmPassword = formData.get('confirmPassword');
            
            // Validation
            if (!name || !email || !department || !password || !confirmPassword) {
                showMessage('signupMessage', 'Please fill in all required fields!', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('signupMessage', 'Passwords do not match!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('signupMessage', 'Password must be at least 6 characters long!', 'error');
                return;
            }
            
            // Check if user already exists
            if (users.find(user => user.email === email)) {
                showMessage('signupMessage', 'User with this email already exists!', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                department: department,
                password: password,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            saveDataToLocalStorage(); // Save to localStorage
            showMessage('signupMessage', 'Account created successfully! Please login.', 'success');
            
            // Clear form
            e.target.reset();
            
            // Switch to login form after 2 seconds
            setTimeout(() => {
                showLogin();
            }, 2000);
        });

        // Handle login
        document.getElementById('loginFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const email = formData.get('email');
            const password = formData.get('password');
            
            // Find user
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                saveDataToLocalStorage(); // Save current user to localStorage
                showMessage('loginMessage', 'Login successful! Redirecting...', 'success');
                
                // Redirect to dashboard after 1 second
                setTimeout(() => {
                    showDashboard();
                }, 1000);
            } else {
                showMessage('loginMessage', 'Invalid email or password!', 'error');
            }
        });

        // Handle logout
        function logout() {
            currentUser = null;
            localStorage.removeItem('itsmCurrentUser'); // Remove current user from localStorage
            document.getElementById('dashboard').classList.add('hidden');
            document.body.style.background = '#f5f1e8';
            showLogin();
            
            // Clear login form
            document.getElementById('loginFormElement').reset();
        }

        // Initialize countdown updater
        setInterval(updateCountdowns, 1000);
    </script>
</body>
</html>